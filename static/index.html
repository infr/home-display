<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Automation</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="container">
      <!-- Car Control Column (1/3) -->
      <div class="sidebar">
        <div id="clock" class="clock"></div>
        <div id="weather" class="weather sidebar-section"></div>
        <div class="car sidebar-section">
          <div class="car-with-range">
            <div class="car-left-info">
              <div class="connection-status disconnected" id="bmwConnection"></div>
              <div id="bmwStatusInfo" style="display: none;">
                <div class="battery-bars" id="bmwBattery">
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                </div>
                <div class="charging-icon" id="bmwCharging">ğŸ”Œ</div>
                <div class="range-display" id="bmwRange">-- km</div>
              </div>
            </div>
            <img src="330.png" alt="BMW Photo" onclick="drive(this)" />
          </div>
          <div class="controls">
            <div class="control-button" onclick="controlBMW('climate', this)">ğŸ”¥</div>
            <div class="control-button" onclick="controlBMW('flash', this)">ğŸ’¡</div>
            <div class="control-button lock-button" id="bmwLockStatus" onclick="controlBMW('lock', this)">ğŸ”’</div>
            <div class="control-button" onclick="controlBMW('unlock', this)">ğŸ”“</div>
          </div>
        </div>
        <div class="car sidebar-section">
          <div class="car-with-range">
            <div class="car-left-info">
              <div class="connection-status disconnected" id="mitsubishiConnection"></div>
              <div id="mitsubishiStatusInfo" style="display: none;">
                <div class="battery-bars" id="mitsubishiBattery">
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                  <div class="battery-bar"></div>
                </div>
                <div class="charging-icon" id="mitsubishiCharging">ğŸ”Œ</div>
                <div class="range-display" id="mitsubishiRange">-- km</div>
              </div>
            </div>
            <img src="outlander.png" alt="Outlander Photo" onclick="driveToChart(this)" />
          </div>
          <div class="controls">
            <div class="control-button" onclick="controlOutlander('remoteHeating', this)">ğŸ”¥</div>
            <div class="control-button" onclick="controlOutlander('lights', this)">ğŸ’¡</div>
          </div>
        </div>
      </div>

      <!-- External Content Column (2/3) -->
      <div class="iframe-container" id="electricity-container">
        <div class="test-mode-indicator" id="testModeIndicator">TEST MODE</div>
        <canvas id="electricityChart"></canvas>
      </div>
    </div>

    <!-- Settings Button -->
    <button class="settings-button" onclick="openSettings()">âš™ï¸</button>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <span class="close" onclick="closeSettings()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="modal-column">
            <div class="setting-item">
              <label for="darkModeSelect">Theme</label>
              <select id="darkModeSelect" onchange="updateDarkMode()">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="auto">Auto (19:00-06:00)</option>
              </select>
            </div>
            <div class="setting-item">
              <label for="maxValue">Max Price Value (c/kWh)</label>
              <input type="number" id="maxValue" value="30" min="10" max="100" onchange="updateMaxValue()">
            </div>
            <div class="setting-item">
              <label for="carStatusInterval">Car Status Update (minutes)</label>
              <input type="number" id="carStatusInterval" value="5" min="1" max="60" onchange="updateCarStatusInterval()">
            </div>
            <div class="setting-item">
              <label for="weatherInterval">Weather Update (minutes)</label>
              <input type="number" id="weatherInterval" value="15" min="5" max="120" onchange="updateWeatherInterval()">
            </div>
            <div class="setting-item">
              <label class="toggle">
                <input type="checkbox" id="testModeToggle" onchange="toggleTestMode()">
                <span>Test Mode (Random Data)</span>
              </label>
            </div>
            <div class="setting-item">
              <button onclick="resetSettings()" style="padding: 8px 16px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-color); cursor: pointer; width: 100%;">Reset All Settings</button>
            </div>
          </div>
          <div class="modal-column logs">
            <div class="setting-item">
              <textarea id="output" readonly rows="15" placeholder="Debug logs (last 10 entries)"></textarea>
              <button onclick="clearDebugLogs()" style="margin-top: 8px; padding: 8px 16px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-color); cursor: pointer;">Clear Log</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Files -->
    <script src="settings.js"></script>
    <script src="electricity.js"></script>
    <script src="car.js"></script>
    <script src="utils.js"></script>
  </body>
</html>
